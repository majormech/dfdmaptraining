// -------------------------------------------
// Full Fire Stations + Response Zones GeoJSON
// (your data pasted directly)
// -------------------------------------------
const RESPONSE_ZONES_GEOJSON = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "response zone": "station 5"
      },
      "geometry": {
        "coordinates": [
          [
            [
              -88.9690609202525,
              39.86373767267119
            ],
            [
              -88.96873303849897,
              39.86377386962011
            ],
            [
              -88.96874251405804,
              39.865653846648385
            ],
            [
              -88.96538177554251,
              39.86565914725401
            ],
            [
              -88.9653437108964,
              39.86575954417307
            ],
            [
              -88.96292204182522,
              39.86577810232084
            ],
            [
              -88.95937995353214,
              39.86580999820207
            ],
            [
              -88.95933287145108,
              39.863738839338026
            ],
            [
              -88.95477611911954,
              39.8637214802451
            ],
            [
              -88.9548732305272,
              39.86945108480769
            ],
            [
              -88.94525355414919,
              39.86972963554152
            ],
            [
              -88.9454409308038,
              39.87708487877254
            ],
            [
              -88.94072867083717,
              39.87725055587741
            ],
            [
              -88.94099834994933,
              39.88793999280438
            ],
            [
              -88.9363577272078,
              39.88804200084676
            ],
            [
              -88.93654430444553,
              39.89178796834311
            ],
            [
              -88.94202644621616,
              39.891710619076946
            ],
            [
              -88.94243637108107,
              39.903752661869845
            ],
            [
              -88.93646199799277,
              39.90405539991879
            ],
            [
              -88.93684247477887,
              39.91354315411294
            ],
            [
              -88.95636878495488,
              39.913130918016066
            ],
            [
              -88.95996835224618,
              39.91299919329589
            ],
            [
              -88.95997609807452,
              39.90971141084134
            ],
            [
              -88.9599300261767,
              39.907514860436265
            ],
            [
              -88.96341778883621,
              39.90736322487851
            ],
            [
              -88.96915701005605,
              39.90736760249365
            ],
            [
              -88.96915701005605,
              39.912816124547646
            ],
            [
              -88.96934484833305,
              39.917008004238056
            ],
            [
              -88.96473381560531,
              39.91709396188688
            ],
            [
              -88.96473381560531,
              39.92388427518162
            ],
            [
              -88.97418002848529,
              39.923675541405515
            ],
            [
              -88.97411142613883,
              39.916348489617064
            ],
            [
              -88.97885552839361,
              39.91649630926764
            ],
            [
              -88.97876501627938,
              39.90869911740003
            ],
            [
              -88.9814307740786,
              39.90907378778493
            ],
            [
              -88.98209307415311,
              39.90704165263941
            ],
            [
              -88.9845433719352,
              39.90676095899147
            ],
            [
              -88.99021556530889,
              39.904710681323024
            ],
            [
              -88.99639982411975,
              39.90112526678655
            ],
            [
              -89.00083667739007,
              39.89805224292542
            ],
            [
              -89.00149118490965,
              39.898791485341064
            ],
            [
              -88.99883679330325,
              39.90073021530441
            ],
            [
              -88.99854590107226,
              39.90208310947523
            ],
            [
              -89.00747265640564,
              39.902487577803186
            ],
            [
              -89.00775931690484,
              39.89773859160471
            ],
            [
              -89.00443828906107,
              39.8977856000927
            ],
            [
              -89.00441897932488,
              39.897230439362176
            ],
            [
              -89.00729821396483,
              39.89714013681643
            ],
            [
              -89.00914527014815,
              39.89553551019188
            ],
            [
              -89.00686389367796,
              39.89398843183929
            ],
            [
              -89.01137768967375,
              39.890734318522675
            ],
            [
              -89.0115001158972,
              39.88272545618648
            ],
            [
              -89.00103290155603,
              39.88286725367007
            ],
            [
              -88.99974383884074,
              39.875067633810005
            ],
            [
              -88.99226842728395,
              39.87517016188349
            ],
            [
              -88.99208794096796,
              39.87112162471115
            ],
            [
              -88.98995836452113,
              39.871195916722655
            ],
            [
              -88.98574733956022,
              39.87117411937618
            ],
            [
              -88.98373912099156,
              39.87110544831842
            ],
            [
              -88.98378882937257,
              39.87265434571404
            ],
            [
              -88.97818172398202,
              39.87273064517427
            ],
            [
              -88.97825156819195,
              39.87316010244868
            ],
            [
              -88.97557210228065,
              39.8717732155047
            ],
            [
              -88.9732315997873,
              39.86962490314184
            ],
            [
              -88.9727934403403,
              39.869185138392965
            ],
            [
              -88.97156322343317,
              39.86707681529643
            ],
            [
              -88.97078801825873,
              39.86564104898537
            ],
            [
              -88.96947353991908,
              39.86402415906153
            ],
            [
              -88.9690609202525,
              39.86373767267119
            ]
          ]
        ],
        "type": "Polygon"
      }
    },
    {
      "type": "Feature",
      "properties": {
        "Fire station": " 5"
      },
      "geometry": {
        "coordinates": [
          -88.96021405081174,
          39.891488506353056
        ],
        "type": "Point"
      }
    },
    {
      "type": "Feature",
      "properties": {
        "response zone": "fire station 4"
      },
      "geometry": {
        "coordinates": [
          [
            [
              -88.94239355968456,
              39.90378897428624
            ],
            [
              -88.94248675667087,
              39.90379629104612
            ],
            [
              -88.94205704380386,
              39.891645322445726
            ],
            [
              -88.93656158996937,
              39.89173525691086
            ],
            [
              -88.93637455815573,
              39.88806500457366
            ],
            [
              -88.94105129610486,
              39.887948497210374
            ],
            [
              -88.94077248513099,
              39.877259571662364
            ],
            [
              -88.94551876866718,
              39.87711326559196
            ],
            [
              -88.9452624193783,
              39.86967522515312
            ],
            [
              -88.94134049930017,
              39.86978414017
            ],
            [
              -88.94099821600669,
              39.863775020139286
            ],
            [
              -88.93660885539192,
              39.868213622124216
            ],
            [
              -88.93606054859588,
              39.8509445514093
            ],
            [
              -88.93378962347032,
              39.85095738464756
            ],
            [
              -88.93274869375291,
              39.84964601707668
            ],
            [
              -88.92626707486244,
              39.85134745369595
            ],
            [
              -88.92647450298574,
              39.85443125488456
            ],
            [
              -88.90131159665977,
              39.858986125002986
            ],
            [
              -88.90128664859519,
              39.86324397746077
            ],
            [
              -88.89818479052174,
              39.86332926980353
            ],
            [
              -88.89804497587751,
              39.86598312215017
            ],
            [
              -88.90848379466543,
              39.866527650784775
            ],
            [
              -88.9086650428577,
              39.87385720614972
            ],
            [
              -88.8976783981803,
              39.87415196537512
            ],
            [
              -88.89763805012079,
              39.881652886642996
            ],
            [
              -88.87886940057314,
              39.88214067447504
            ],
            [
              -88.8789181851324,
              39.885425764480715
            ],
            [
              -88.88238264453335,
              39.88590405210249
            ],
            [
              -88.88259691444269,
              39.89355434467578
            ],
            [
              -88.89771266713998,
              39.89299791558608
            ],
            [
              -88.89775642901532,
              39.894139030483444
            ],
            [
              -88.89799481522928,
              39.90012126208546
            ],
            [
              -88.89231366565744,
              39.90023750542892
            ],
            [
              -88.89273298227656,
              39.90359290617499
            ],
            [
              -88.8802934260449,
              39.90355363169127
            ],
            [
              -88.88051849102297,
              39.90797073965385
            ],
            [
              -88.88961787176437,
              39.908080296655214
            ],
            [
              -88.89163667853148,
              39.907545509852696
            ],
            [
              -88.89275632295598,
              39.90753025189133
            ],
            [
              -88.89592259446154,
              39.9086472503044
            ],
            [
              -88.89877023843736,
              39.90572395504486
            ],
            [
              -88.89808320297672,
              39.90473526267371
            ],
            [
              -88.89815094260017,
              39.90021078832402
            ],
            [
              -88.902416350122,
              39.90015216906886
            ],
            [
              -88.90382267571059,
              39.90055167742156
            ],
            [
              -88.91744601213085,
              39.90452940440346
            ],
            [
              -88.94239355968456,
              39.90378897428624
            ]
          ]
        ],
        "type": "Polygon"
      }
    },
    {
      "type": "Feature",
      "properties": {
        "Fire station ": 4
      },
      "geometry": {
        "coordinates": [
          -88.92551821933287,
          39.873716964713594
        ],
        "type": "Point"
      }
    },
    {
      "type": "Feature",
      "properties": {
        "Fire Station": 2
      },
      "geometry": {
        "coordinates": [
          -88.914344458341,
          39.844797281126034
        ],
        "type": "Point"
      }
    },
    {
      "type": "Feature",
      "properties": {
        "Response Zone": "Station 2"
      },
      "geometry": {
        "coordinates": [
          [
            [
              -88.9013043984642,
              39.85900730217293
            ],
            [
              -88.92663288868218,
              39.8544502062297
            ],
            [
              -88.92632349188426,
              39.851348385611175
            ],
            [
              -88.94052743124409,
              39.847703940749824
            ],
            [
              -88.94553311331887,
              39.84768487185562
            ],
            [
              -88.94612742975326,
              39.84598623354077
            ],
            [
              -88.94759272719384,
              39.84375397775358
            ],
            [
              -88.943427918264,
              39.84382165677522
            ],
            [
              -88.94333927594143,
              39.84050146673704
            ],
            [
              -88.94039394636054,
              39.840598774458954
            ],
            [
              -88.94030722637757,
              39.83699380408444
            ],
            [
              -88.93571859734209,
              39.83713669987711
            ],
            [
              -88.93543999188103,
              39.83069773632539
            ],
            [
              -88.93409404986447,
              39.83076427410029
            ],
            [
              -88.93280565103748,
              39.830819745958195
            ],
            [
              -88.93062480632496,
              39.8315431406256
            ],
            [
              -88.93071600040535,
              39.833557638597284
            ],
            [
              -88.92599124429853,
              39.83375310514009
            ],
            [
              -88.92567170410635,
              39.83380012714517
            ],
            [
              -88.92596389260704,
              39.83102733152015
            ],
            [
              -88.9217098843223,
              39.831718411645
            ],
            [
              -88.91131843838724,
              39.83619455779501
            ],
            [
              -88.88568932855135,
              39.8531060421775
            ],
            [
              -88.88010363773289,
              39.8628229177952
            ],
            [
              -88.86438098908877,
              39.88277351692108
            ],
            [
              -88.87872390376883,
              39.88224333371582
            ],
            [
              -88.89767391904478,
              39.881664660867415
            ],
            [
              -88.89767014893759,
              39.87417653632488
            ],
            [
              -88.908832641882,
              39.87391651414703
            ],
            [
              -88.90862878350801,
              39.8664084337382
            ],
            [
              -88.89813647798654,
              39.865831239437085
            ],
            [
              -88.89821906731436,
              39.86337707359317
            ],
            [
              -88.90145679353559,
              39.86329832374517
            ],
            [
              -88.9013043984642,
              39.85900730217293
            ]
          ]
        ],
        "type": "Polygon"
      }
    },
    {
      "type": "Feature",
      "properties": {
        "Fire Station ": 7
      },
      "geometry": {
        "coordinates": [
          -88.89859770023807,
          39.82566375671385
        ],
        "type": "Point"
      }
    },
    {
      "type": "Feature",
      "properties": {
        "response zone ": "station 7"
      },
      "geometry": {
        "coordinates": [
          [
            [
              -88.88556227237108,
              39.8531485513418
            ],
            [
              -88.90814521782183,
              39.83737074922033
            ],
            [
              -88.91629287920412,
              39.833893963153486
            ],
            [
              -88.92092270025094,
              39.829862717345065
            ],
            [
              -88.93807801238417,
              39.816806351472934
            ],
            [
              -88.92901006146842,
              39.811859694665884
            ],
            [
              -88.92049012417662,
              39.8068057670186
            ],
            [
              -88.91381887909664,
              39.8070865065138
            ],
            [
              -88.90630439159231,
              39.80144389056326
            ],
            [
              -88.89900731895435,
              39.8007280172433
            ],
            [
              -88.89342264925497,
              39.799803012826175
            ],
            [
              -88.89231515266405,
              39.81973805113944
            ],
            [
              -88.88790033668333,
              39.81985362019802
            ],
            [
              -88.88772982318889,
              39.82175603933953
            ],
            [
              -88.88762337438551,
              39.82003703711146
            ],
            [
              -88.88750278223297,
              39.81989453910617
            ],
            [
              -88.88432075754281,
              39.819932799084995
            ],
            [
              -88.88417649820899,
              39.81562180101554
            ],
            [
              -88.87829920106167,
              39.81557619307199
            ],
            [
              -88.87833485553934,
              39.81165088684065
            ],
            [
              -88.87800083239274,
              39.81164002052705
            ],
            [
              -88.87339066841261,
              39.8116793141013
            ],
            [
              -88.87356075452897,
              39.819285232940786
            ],
            [
              -88.87412770140915,
              39.81962977637218
            ],
            [
              -88.87362972885067,
              39.81999216277606
            ],
            [
              -88.86533555864295,
              39.82016286225584
            ],
            [
              -88.86568184156958,
              39.827078443545275
            ],
            [
              -88.85648044163152,
              39.83055725162009
            ],
            [
              -88.85256453508204,
              39.831353722352446
            ],
            [
              -88.84511003341626,
              39.83783363878425
            ],
            [
              -88.84474263997288,
              39.84375223148368
            ],
            [
              -88.85018020032294,
              39.84397181312124
            ],
            [
              -88.85034952844421,
              39.84206322804553
            ],
            [
              -88.85062166840036,
              39.841143570613355
            ],
            [
              -88.86017509020554,
              39.83707778836762
            ],
            [
              -88.86557658526044,
              39.83914704297956
            ],
            [
              -88.86912271127179,
              39.84187643496054
            ],
            [
              -88.8693457519575,
              39.8456191564172
            ],
            [
              -88.86472246644206,
              39.84564814680007
            ],
            [
              -88.86481685552847,
              39.84942986914413
            ],
            [
              -88.86904000945054,
              39.84959627495948
            ],
            [
              -88.86917631708354,
              39.85367354450398
            ],
            [
              -88.87200020111639,
              39.85434273663495
            ],
            [
              -88.87440657265152,
              39.85468513299958
            ],
            [
              -88.87445093823091,
              39.85983449494569
            ],
            [
              -88.87273619211142,
              39.86376145762907
            ],
            [
              -88.87997903552574,
              39.863188014436986
            ],
            [
              -88.87882129979769,
              39.851774747074614
            ],
            [
              -88.88556227237108,
              39.8531485513418
            ]
          ]
        ],
        "type": "Polygon"
      }
    },
    {
      "type": "Feature",
      "properties": {
        "Fire station ": 6
      },
      "geometry": {
        "coordinates": [
          -88.9598721522665,
          39.82032920568267
        ],
        "type": "Point"
      }
    },
    {
      "type": "Feature",
      "properties": {
        "response zone": "station 6"
      },
      "geometry": {
        "coordinates": [
          [
            [
              -88.92042564139989,
              39.806856529334794
            ],
            [
              -88.937994674751,
              39.816888905439015
            ],
            [
              -88.92525506481384,
              39.8266876167699
            ],
            [
              -88.92595516560093,
              39.83105901600547
            ],
            [
              -88.92566341909003,
              39.833821884914215
            ],
            [
              -88.93073175783042,
              39.83357678726259
            ],
            [
              -88.93064905710847,
              39.83155449312963
            ],
            [
              -88.93283138745598,
              39.83083040824087
            ],
            [
              -88.93536851937239,
              39.83076824682479
            ],
            [
              -88.93570861815923,
              39.83717784986436
            ],
            [
              -88.94028890305947,
              39.8370228262269
            ],
            [
              -88.94039795976347,
              39.84060803705984
            ],
            [
              -88.94333042657503,
              39.84053194661561
            ],
            [
              -88.94336507338406,
              39.8438373064798
            ],
            [
              -88.94748554642742,
              39.84379330469679
            ],
            [
              -88.94955483352368,
              39.84060724991366
            ],
            [
              -88.94947282778871,
              39.84367787883696
            ],
            [
              -88.95298761723595,
              39.84373369812937
            ],
            [
              -88.95285694703996,
              39.83703772146683
            ],
            [
              -88.95582442253507,
              39.837477185455754
            ],
            [
              -88.95580701154438,
              39.840354930102706
            ],
            [
              -88.95723294917161,
              39.840307735081296
            ],
            [
              -88.95718058638354,
              39.84138812274284
            ],
            [
              -88.96186778963714,
              39.841252384016514
            ],
            [
              -88.96349121937182,
              39.841252384016514
            ],
            [
              -88.96357377824168,
              39.84024429237306
            ],
            [
              -88.96351777429051,
              39.8391911023476
            ],
            [
              -88.96043090530107,
              39.8391911023476
            ],
            [
              -88.96039639468336,
              39.83812125600414
            ],
            [
              -88.95885577562755,
              39.8381090433073
            ],
            [
              -88.9589030903152,
              39.83741000249617
            ],
            [
              -88.96002712505447,
              39.833717225816855
            ],
            [
              -88.9617360046888,
              39.83214075125065
            ],
            [
              -88.96658925550176,
              39.83292214625391
            ],
            [
              -88.96673835520609,
              39.83276275010371
            ],
            [
              -88.96689932741106,
              39.83259158543342
            ],
            [
              -88.96699344439124,
              39.832413145246534
            ],
            [
              -88.9670691181876,
              39.83222443292266
            ],
            [
              -88.96784828507464,
              39.83206216394052
            ],
            [
              -88.96955261446598,
              39.83146817853037
            ],
            [
              -88.97047881830086,
              39.83076651934928
            ],
            [
              -88.97133046742452,
              39.83033495056327
            ],
            [
              -88.97202876999714,
              39.83103594659622
            ],
            [
              -88.97279768025454,
              39.8318458056564
            ],
            [
              -88.97456543412719,
              39.83190030310243
            ],
            [
              -88.97725917657536,
              39.830712931611174
            ],
            [
              -88.97931274449749,
              39.829473009686666
            ],
            [
              -88.98228173868075,
              39.82775292666244
            ],
            [
              -88.98643905648368,
              39.827376304433926
            ],
            [
              -88.99045460823146,
              39.82743052467103
            ],
            [
              -88.99186652159656,
              39.8281823208022
            ],
            [
              -88.9939332984961,
              39.832440502241184
            ],
            [
              -88.9979752034707,
              39.833847600819325
            ],
            [
              -89.0001491305448,
              39.83179196689915
            ],
            [
              -89.00838141380326,
              39.83395594344313
            ],
            [
              -89.01096758637681,
              39.832007757925425
            ],
            [
              -89.01270990869118,
              39.834715166634
            ],
            [
              -89.01729689949023,
              39.83373910965409
            ],
            [
              -89.02092258400313,
              39.83157579228188
            ],
            [
              -89.02387944417985,
              39.82877457718121
            ],
            [
              -89.02315737889337,
              39.82571787631801
            ],
            [
              -89.02887988665744,
              39.82435500249923
            ],
            [
              -89.02874774286053,
              39.81747754486767
            ],
            [
              -89.0006649988544,
              39.817785360167164
            ],
            [
              -89.00027020465305,
              39.808439929109056
            ],
            [
              -88.99960784915227,
              39.80827292665947
            ],
            [
              -88.99589965904538,
              39.810294690945085
            ],
            [
              -88.99589415131706,
              39.79491883239038
            ],
            [
              -88.99095904421276,
              39.79248977230887
            ],
            [
              -88.98651300295894,
              39.792496808935994
            ],
            [
              -88.98633784417315,
              39.789104826229845
            ],
            [
              -88.97698910129616,
              39.78918601709384
            ],
            [
              -88.97710910851887,
              39.78739156210847
            ],
            [
              -88.97444024860273,
              39.78627506042136
            ],
            [
              -88.97422708933637,
              39.78925246534237
            ],
            [
              -88.96653522174468,
              39.78929806695402
            ],
            [
              -88.96743389938877,
              39.79647345783425
            ],
            [
              -88.95329125380161,
              39.79678007881233
            ],
            [
              -88.94381710960367,
              39.797078657019455
            ],
            [
              -88.94339980993097,
              39.800060846042385
            ],
            [
              -88.93630617527398,
              39.79801916583787
            ],
            [
              -88.93430371018877,
              39.79667352247
            ],
            [
              -88.92941514688707,
              39.7944031000867
            ],
            [
              -88.92942132255956,
              39.79733484007954
            ],
            [
              -88.9193790540643,
              39.79794028233445
            ],
            [
              -88.91953612961656,
              39.80442586122322
            ],
            [
              -88.9189488833859,
              39.80452345227047
            ],
            [
              -88.91564008650818,
              39.80467643816391
            ],
            [
              -88.9135729371471,
              39.80710448602463
            ],
            [
              -88.92042564139989,
              39.806856529334794
            ]
          ]
        ],
        "type": "Polygon"
      }
    },
    {
      "type": "Feature",
      "properties": {
        "Fire station": 1
      },
      "geometry": {
        "coordinates": [
          -88.95561750096293,
          39.85597068440575
        ],
        "type": "Point"
      }
    },
    {
      "type": "Feature",
      "properties": {
        "response zone": "Station 1"
      },
      "geometry": {
        "coordinates": [
          [
            [
              -88.9558160860821,
              39.837457840796134
            ],
            [
              -88.95284276764721,
              39.837011421813855
            ],
            [
              -88.9530657321912,
              39.84361842805288
            ],
            [
              -88.94957126651019,
              39.843666183366594
            ],
            [
              -88.94961581316925,
              39.84056506648059
            ],
            [
              -88.94601864759377,
              39.84609902628668
            ],
            [
              -88.94551000208958,
              39.84764993848805
            ],
            [
              -88.94051686879422,
              39.847635040016115
            ],
            [
              -88.93284850877463,
              39.84965185345962
            ],
            [
              -88.93374910105227,
              39.850938186299544
            ],
            [
              -88.93603965154125,
              39.850948600470986
            ],
            [
              -88.9365742578721,
              39.86824079555484
            ],
            [
              -88.9409600902976,
              39.863819353542624
            ],
            [
              -88.94118304608732,
              39.86935778634057
            ],
            [
              -88.94122618398494,
              39.86983786060247
            ],
            [
              -88.95492300028202,
              39.86946544437794
            ],
            [
              -88.95477716978114,
              39.863728702650036
            ],
            [
              -88.95933680167953,
              39.86374206082252
            ],
            [
              -88.95937160802983,
              39.865812546117354
            ],
            [
              -88.96535023990641,
              39.86576061105217
            ],
            [
              -88.96537498031886,
              39.86566566367503
            ],
            [
              -88.9687653034523,
              39.86566747152273
            ],
            [
              -88.9687097108423,
              39.863704620081506
            ],
            [
              -88.96909885911013,
              39.86372168859691
            ],
            [
              -88.96833168109683,
              39.863115753699276
            ],
            [
              -88.96822854553291,
              39.86080263830459
            ],
            [
              -88.96898541540557,
              39.860775298243055
            ],
            [
              -88.96891065627239,
              39.85463802922547
            ],
            [
              -88.96834847003059,
              39.85463138960904
            ],
            [
              -88.96827712911268,
              39.849716917130934
            ],
            [
              -88.96370858636686,
              39.849791384123364
            ],
            [
              -88.96359212011907,
              39.84564435004569
            ],
            [
              -88.96055502975668,
              39.84573472971519
            ],
            [
              -88.96053148642058,
              39.84351135530616
            ],
            [
              -88.96194408658933,
              39.843439049237986
            ],
            [
              -88.96191941801966,
              39.84124853880971
            ],
            [
              -88.9572333593082,
              39.84137574287948
            ],
            [
              -88.95725702627132,
              39.840303586918736
            ],
            [
              -88.95583700848033,
              39.84033993146261
            ],
            [
              -88.95581334151719,
              39.83848633519489
            ],
            [
              -88.9558160860821,
              39.837457840796134
            ]
          ]
        ],
        "type": "Polygon"
      }
    },
    {
      "type": "Feature",
      "properties": {
        "fire station": 3
      },
      "geometry": {
        "coordinates": [
          -88.97792916478973,
          39.84839423417688
        ],
        "type": "Point"
      },
      "id": 12
    },
    {
      "type": "Feature",
      "properties": {
        "response zone ": "station 3"
      },
      "geometry": {
        "coordinates": [
          [
            [
              -88.95886247236889,
              39.83807681019118
            ],
            [
              -88.95884682436106,
              39.838120367046
            ],
            [
              -88.9603808987112,
              39.83814721100822
            ],
            [
              -88.9604113297268,
              39.83921607911725
            ],
            [
              -88.96349467926089,
              39.839212379971144
            ],
            [
              -88.96335184370389,
              39.841206359892
            ],
            [
              -88.96180162164102,
              39.84124202364137
            ],
            [
              -88.9619159374647,
              39.843425761189565
            ],
            [
              -88.96049601844096,
              39.84349252144787
            ],
            [
              -88.96051938157811,
              39.845751544430186
            ],
            [
              -88.96353297048331,
              39.84573905613672
            ],
            [
              -88.96356878059244,
              39.84983312333611
            ],
            [
              -88.9682568886255,
              39.849741057163556
            ],
            [
              -88.96814230469714,
              39.8548303231625
            ],
            [
              -88.96880617630414,
              39.85484826313689
            ],
            [
              -88.96893135564451,
              39.86074611893082
            ],
            [
              -88.96811983176508,
              39.8607903457455
            ],
            [
              -88.96828303179042,
              39.86310665114166
            ],
            [
              -88.96906143686039,
              39.86374988451135
            ],
            [
              -88.97063077008181,
              39.86562269492106
            ],
            [
              -88.97270198205764,
              39.86912205006567
            ],
            [
              -88.97414237614353,
              39.870545720727904
            ],
            [
              -88.97543977732283,
              39.87181224166355
            ],
            [
              -88.97829609087184,
              39.873225469129096
            ],
            [
              -88.97823704605574,
              39.87278748532216
            ],
            [
              -88.98385782129695,
              39.87277744431543
            ],
            [
              -88.98376513323349,
              39.87117393519304
            ],
            [
              -88.99201702217289,
              39.871163375045825
            ],
            [
              -88.99536327181917,
              39.86949769346833
            ],
            [
              -89.00591876469038,
              39.8685275404861
            ],
            [
              -89.01075893900995,
              39.86858253791891
            ],
            [
              -89.01119102026762,
              39.867466787657435
            ],
            [
              -89.01959823695492,
              39.86768585964904
            ],
            [
              -89.02025343381483,
              39.857064036034075
            ],
            [
              -89.01499318655404,
              39.850495853495005
            ],
            [
              -89.02887687039484,
              39.85336593653099
            ],
            [
              -89.02872866860793,
              39.8305841323957
            ],
            [
              -89.0199448670945,
              39.831022799600646
            ],
            [
              -89.01358376287375,
              39.83385027930066
            ],
            [
              -89.01059567594454,
              39.83142570437198
            ],
            [
              -89.00777060841799,
              39.83319933052729
            ],
            [
              -88.99917245399796,
              39.83158741367379
            ],
            [
              -88.99779997879507,
              39.833562642663196
            ],
            [
              -88.99433966590868,
              39.832216298037565
            ],
            [
              -88.9922061156629,
              39.82807211513065
            ],
            [
              -88.99087183228309,
              39.82740537445733
            ],
            [
              -88.98284264845732,
              39.82732206083355
            ],
            [
              -88.97959868556997,
              39.82882494177204
            ],
            [
              -88.97445318874045,
              39.83169232707672
            ],
            [
              -88.97293855016596,
              39.83169232707672
            ],
            [
              -88.97136645588533,
              39.830232657531155
            ],
            [
              -88.96700077954442,
              39.83211895929173
            ],
            [
              -88.96655782691715,
              39.83280686480717
            ],
            [
              -88.96184387575568,
              39.831951926499954
            ],
            [
              -88.95995677820102,
              39.83360878699261
            ],
            [
              -88.95886247236889,
              39.83807681019118
            ]
          ]
        ],
        "type": "Polygon"
      },
      "id": 13
    }
  ]
};

// -------------------------------
// Controls & global state
// -------------------------------
const newDrillBtn = document.getElementById("new-drill");
const startGameBtn = document.getElementById("start-game");
const startRouteGameBtn = document.getElementById("start-route-game");
const submitRouteBtn = document.getElementById("submit-route");
const stationSelect = document.getElementById("station-select");
const zonesCheckbox = document.getElementById("toggle-zones");
const streetNamesCheckbox = document.getElementById("toggle-street-names");
const addressSpan = document.getElementById("address");
const statusSpan = document.getElementById("status");
const gameInfoSpan = document.getElementById("game-info");
const gameScoreSpan = document.getElementById("game-score");

let map;
let geocoder;

// Rough city box (fallback)
const decaturBounds = {
  minLat: 39.8,
  maxLat: 39.9,
  minLng: -89.05,
  maxLng: -88.85,
};

// Snazzy / no-labels style
const NO_LABELS_STYLE = [
  {
    featureType: "all",
    elementType: "labels.text",
    stylers: [{ visibility: "off" }],
  },
  {
    featureType: "all",
    elementType: "labels.icon",
    stylers: [{ visibility: "off" }],
  },
];

// Station colors
const STATION_COLORS = {
  "1": "#FF0000",
  "2": "#0055FF",
  "3": "#00AA55",
  "4": "#FF7F00",
  "5": "#AA00FF",
  "6": "#00CCBB",
  "7": "#FFFF00",
};

// Stations / zones
let stationMarkers = [];
let stationZonePolygons = [];
const STATIONS_BY_ID = {};

// Drill markers
let actualMarker = null;
let guessMarker = null;
let clickListener = null;

// Distance game state (10-address “classic”)
let gameActive = false;
const gameRoundsTotal = 10;
let currentRound = 0;
let totalScore = 0;
let gameHistory = [];

// Route game state (10-address “route mode”)
let routeGameActive = false;
const routeRoundsTotal = 10;
let routeCurrentRound = 0;
let routeTotalScore = 0;
let routeHistory = [];
let currentRoutePolyline = null;
let currentRoutePath = [];
let currentRouteAnswer = null;
let currentRouteStationId = null;

// -------------------------------
// Helpers
// -------------------------------
function setStatus(msg) {
  statusSpan.textContent = msg;
}

function metersToFeet(m) {
  return m * 3.28084;
}

function rand(min, max) {
  return min + Math.random() * (max - min);
}

// Scoring rules (for both games)
function scoreFromFeet(distFeet) {
  if (distFeet <= 150) {
    return 1;
  } else if (distFeet <= 600) {
    const minD = 151;
    const maxD = 600;
    const t = Math.min(Math.max((distFeet - minD) / (maxD - minD), 0), 1);
    return Math.round(2 + t * (300 - 2));
  } else if (distFeet <= 1750) {
    const minD = 601;
    const maxD = 1750;
    const t = Math.min(Math.max((distFeet - minD) / (maxD - minD), 0), 1);
    return Math.round(301 + t * (750 - 301));
  } else {
    return 1000;
  }
}

// Map style & zones
function applyMapStyle() {
  if (!map) return;
  if (streetNamesCheckbox.checked) {
    map.setOptions({ styles: [] });
  } else {
    map.setOptions({ styles: NO_LABELS_STYLE });
  }
}

function applyZoneVisibility() {
  if (!map) return;
  const show = zonesCheckbox.checked;
  stationZonePolygons.forEach(({ polygon }) =>
    polygon.setMap(show ? map : null)
  );
}

// Game UI (handles both games)
function updateGameUI() {
  if (gameActive) {
    gameInfoSpan.textContent = `Distance Game: round ${currentRound}/${gameRoundsTotal}`;
    gameScoreSpan.textContent = `Score: ${totalScore}`;
  } else if (routeGameActive) {
    gameInfoSpan.textContent = `Route Game: round ${routeCurrentRound}/${routeRoundsTotal}`;
    gameScoreSpan.textContent = `Route Score: ${routeTotalScore}`;
  } else {
    gameInfoSpan.textContent = "Game: not running";
    gameScoreSpan.textContent = `Score: 0`;
  }
}

// Popup summaries
function showFinalResults() {
  let summary = "10-Address Distance Game Complete\n\n";
  summary += `Total Score: ${totalScore}\n\n`;
  summary += "Round details:\n\n";

  gameHistory.forEach((entry) => {
    summary += `Round ${entry.round}: ${entry.address}\n`;
    summary += `  Distance: ${entry.distanceFeet.toFixed(
      0
    )} ft, Points: ${entry.points}\n\n`;
  });

  alert(summary);
}

function showRouteFinalResults() {
  let summary = "10-Address Route Game Complete\n\n";
  summary += `Total Route Score: ${routeTotalScore}\n\n`;
  summary += "Round details:\n\n";

  routeHistory.forEach((entry) => {
    summary += `Round ${entry.round}: ${entry.address}\n`;
    summary += `  Distance: ${entry.distanceFeet.toFixed(
      0
    )} ft, Points: ${entry.points}\n\n`;
  });

  alert(summary);
}

// -------------------------------
// Geocoding helpers
// -------------------------------
function geocodeLatLng(lat, lng) {
  return new Promise((resolve) => {
    geocoder.geocode({ location: { lat, lng } }, (results, status) => {
      if (status === "OK" && results && results.length) {
        resolve(results[0]);
      } else {
        resolve(null);
      }
    });
  });
}

function getComponent(components, type) {
  const c = components.find((ac) => ac.types.includes(type));
  return c ? c.long_name : "";
}

function formatAddressFromResult(result) {
  const comps = result.address_components || [];
  const house = getComponent(comps, "street_number");
  const road = getComponent(comps, "route");
  const city = getComponent(comps, "locality");

  if (!house || !road || !city) return null;
  return `${house} ${road}, ${city}, IL`;
}

// City-wide random (fallback)
async function getRandomDecaturAddressCityWide() {
  for (let i = 0; i < 40; i++) {
    const lat = rand(decaturBounds.minLat, decaturBounds.maxLat);
    const lng = rand(decaturBounds.minLng, decaturBounds.maxLng);

    const result = await geocodeLatLng(lat, lng);
    if (!result) continue;

    const label = formatAddressFromResult(result);
    if (!label) continue;

    const comps = result.address_components || [];
    const city =
      getComponent(comps, "locality") ||
      getComponent(comps, "postal_town") ||
      "";
    if (city.toLowerCase() !== "decatur") continue;

    return { lat, lng, label };
  }

  throw new Error("Could not find a random Decatur address. Try again.");
}

// -------------------------------
// Sampling within station polygons
// -------------------------------
function getPolygonsForStation(stationId) {
  return stationZonePolygons
    .filter((z) => z.stationId === stationId)
    .map((z) => z.polygon);
}

function getRandomPointInPolygon(polygon) {
  const bounds = new google.maps.LatLngBounds();
  const path = polygon.getPath();
  for (let i = 0; i < path.getLength(); i++) {
    bounds.extend(path.getAt(i));
  }

  const sw = bounds.getSouthWest();
  const ne = bounds.getNorthEast();

  for (let i = 0; i < 50; i++) {
    const lat = rand(sw.lat(), ne.lat());
    const lng = rand(sw.lng(), ne.lng());
    const point = new google.maps.LatLng(lat, lng);
    if (google.maps.geometry.poly.containsLocation(point, polygon)) {
      return point;
    }
  }

  return path.getAt(0);
}

async function getRandomAddressInStationZone(stationId) {
  const polygons = getPolygonsForStation(stationId);
  if (!polygons.length) {
    return getRandomDecaturAddressCityWide();
  }

  for (let attempt = 0; attempt < 80; attempt++) {
    const polygon =
      polygons[Math.floor(Math.random() * polygons.length)];
    const point = getRandomPointInPolygon(polygon);
    const lat = point.lat();
    const lng = point.lng();

    const result = await geocodeLatLng(lat, lng);
    if (!result) continue;

    const label = formatAddressFromResult(result);
    if (!label) continue;

    const comps = result.address_components || [];
    const city =
      getComponent(comps, "locality") ||
      getComponent(comps, "postal_town") ||
      "";
    if (city.toLowerCase() !== "decatur") continue;

    return { lat, lng, label, stationId };
  }

  throw new Error(
    `Could not find a random address in Station ${stationId}'s zone.`
  );
}

async function getRandomAddressForDrill() {
  const selected = stationSelect.value; // "any" or "1".."7"

  const availableStationIds = [
    ...new Set(stationZonePolygons.map((z) => z.stationId)),
  ];

  if (!availableStationIds.length) {
    return getRandomDecaturAddressCityWide();
  }

  let stationIdToUse;

  if (selected === "any") {
    stationIdToUse =
      availableStationIds[
        Math.floor(Math.random() * availableStationIds.length)
      ];
  } else {
    stationIdToUse = selected;
  }

  return getRandomAddressInStationZone(stationIdToUse);
}

// -------------------------------
// Drill reset
// -------------------------------
function resetDrill() {
  if (actualMarker) {
    actualMarker.setMap(null);
    actualMarker = null;
  }
  if (guessMarker) {
    guessMarker.setMap(null);
    guessMarker = null;
  }
  if (clickListener) {
    google.maps.event.removeListener(clickListener);
    clickListener = null;
  }
  if (currentRoutePolyline) {
    currentRoutePolyline.setMap(null);
    currentRoutePolyline = null;
  }
  currentRoutePath = [];
  currentRouteAnswer = null;
}

// -------------------------------
// Classic Drill / Distance Game
// -------------------------------
async function runDrill(isGameRound) {
  resetDrill();

  const sel = stationSelect.value;
  if (isGameRound) {
    setStatus(
      sel === "any"
        ? `Round ${currentRound}/${gameRoundsTotal}: random station zone…`
        : `Round ${currentRound}/${gameRoundsTotal}: Station ${sel} zone…`
    );
  } else {
    setStatus(
      sel === "any"
        ? "Single drill: random station zone…"
        : `Single drill: Station ${sel} zone…`
    );
  }

  addressSpan.textContent = "Searching…";

  let addrInfo;
  try {
    addrInfo = await getRandomAddressForDrill();
  } catch (err) {
    console.error(err);
    addressSpan.textContent = "None – try again";
    setStatus(err.message || "Couldn't find a valid address.");
    return;
  }

  const stationLabel =
    addrInfo.stationId ||
    (stationSelect.value === "any" ? "?" : stationSelect.value);

  addressSpan.textContent = `${addrInfo.label} (S${stationLabel})`;
  setStatus(
    isGameRound
      ? `Round ${currentRound}/${gameRoundsTotal}: Click where you think this address is.`
      : "Click on the map where you think this address is."
  );

  actualMarker = new google.maps.Marker({
    position: { lat: addrInfo.lat, lng: addrInfo.lng },
    map,
    opacity: 0,
  });

  // User clicks once, we immediately grade
  clickListener = map.addListener("click", (e) => {
    if (guessMarker) guessMarker.setMap(null);
    guessMarker = new google.maps.Marker({
      position: e.latLng,
      map,
    });

    // Reveal correct location
    actualMarker.setOpacity(1);

    const from = e.latLng;
    const to = new google.maps.LatLng(addrInfo.lat, addrInfo.lng);

    const distMeters =
      google.maps.geometry.spherical.computeDistanceBetween(from, to);
    const distFeet = metersToFeet(distMeters);
    const points = scoreFromFeet(distFeet);

    const info = new google.maps.InfoWindow({
      content: `<b>${addrInfo.label}</b><br>${distFeet.toFixed(
        0
      )} ft<br>${points} pts`,
      position: { lat: addrInfo.lat, lng: addrInfo.lng },
    });
    info.open(map, actualMarker);

    const bounds = new google.maps.LatLngBounds();
    bounds.extend(actualMarker.getPosition());
    bounds.extend(guessMarker.getPosition());
    map.fitBounds(bounds);

    if (isGameRound && gameActive) {
      totalScore += points;
      gameHistory.push({
        round: currentRound,
        address: addrInfo.label,
        distanceFeet: distFeet,
        points,
      });

      setStatus(
        `Round ${currentRound}: ${distFeet.toFixed(
          0
        )} ft → ${points} pts. Total score: ${totalScore} (lower is better).`
      );
      updateGameUI();

      if (currentRound >= gameRoundsTotal) {
        gameActive = false;
        updateGameUI();
        setTimeout(showFinalResults, 300);
      } else {
        setTimeout(() => {
          if (gameActive) startGameRound();
        }, 1500);
      }
    } else if (!isGameRound) {
      setStatus(
        'Single drill complete. Click "Single Drill" for another address.'
      );
    }

    google.maps.event.removeListener(clickListener);
    clickListener = null;
  });
}

function startSingleDrill() {
  gameActive = false;
  routeGameActive = false;
  currentRound = 0;
  totalScore = 0;
  gameHistory = [];
  routeCurrentRound = 0;
  routeTotalScore = 0;
  routeHistory = [];
  updateGameUI();

  runDrill(false);
}

function startGame() {
  gameActive = true;
  routeGameActive = false;
  currentRound = 0;
  totalScore = 0;
  gameHistory = [];
  routeCurrentRound = 0;
  routeTotalScore = 0;
  routeHistory = [];
  updateGameUI();
  startGameRound();
}

function startGameRound() {
  if (!gameActive) return;
  currentRound += 1;
  updateGameUI();
  runDrill(true);
}

// -------------------------------
// Route Game
// -------------------------------
async function startRouteRound() {
  if (!routeGameActive) return;
  resetDrill();

  routeCurrentRound += 1;
  updateGameUI();

  const sel = stationSelect.value;
  setStatus(
    sel === "any"
      ? `Route round ${routeCurrentRound}/${routeRoundsTotal}: random station zone…`
      : `Route round ${routeCurrentRound}/${routeRoundsTotal}: Station ${sel} zone…`
  );
  addressSpan.textContent = "Searching…";

  let addrInfo;
  try {
    addrInfo = await getRandomAddressForDrill();
  } catch (err) {
    console.error(err);
    addressSpan.textContent = "None – try again";
    setStatus(err.message || "Couldn't find a valid address.");
    return;
  }

  currentRouteAnswer = addrInfo;
  currentRouteStationId =
    addrInfo.stationId ||
    (stationSelect.value === "any" ? null : stationSelect.value);

  const stationLabel =
    currentRouteStationId || (stationSelect.value === "any" ? "?" : "unknown");

  addressSpan.textContent = `${addrInfo.label} (S${stationLabel})`;

  actualMarker = new google.maps.Marker({
    position: { lat: addrInfo.lat, lng: addrInfo.lng },
    map,
    opacity: 0,
  });

  currentRoutePath = [];

  // Set up click handler: build route from station to guess.
  clickListener = map.addListener("click", (e) => {
    const clickLatLng = e.latLng;

    // First time: add station as starting point if we know it
    if (currentRoutePath.length === 0) {
      if (
        currentRouteStationId &&
        STATIONS_BY_ID[currentRouteStationId]
      ) {
        const st = STATIONS_BY_ID[currentRouteStationId];
        currentRoutePath.push(
          new google.maps.LatLng(st.lat, st.lng)
        );
      } else {
        // fallback: start at first click
        currentRoutePath.push(clickLatLng);
      }
    }

    currentRoutePath.push(clickLatLng);

    if (guessMarker) guessMarker.setMap(null);
    guessMarker = new google.maps.Marker({
      position: clickLatLng,
      map,
    });

    if (!currentRoutePolyline) {
      currentRoutePolyline = new google.maps.Polyline({
        map,
        path: currentRoutePath,
        strokeColor: "#ffffff",
        strokeOpacity: 1.0,
        strokeWeight: 3,
      });
    } else {
      currentRoutePolyline.setPath(currentRoutePath);
    }

    setStatus(
      "Route updated. Click more points to refine, then press 'Submit Route'."
    );
  });

  setStatus(
    `Route Round ${routeCurrentRound}/${routeRoundsTotal}: ` +
      "click along your route from the station to the address. " +
      "Your last click is your address guess. Then press 'Submit Route'."
  );
}

function startRouteGame() {
  routeGameActive = true;
  gameActive = false;

  routeCurrentRound = 0;
  routeTotalScore = 0;
  routeHistory = [];
  currentRound = 0;
  totalScore = 0;
  gameHistory = [];

  resetDrill();
  updateGameUI();
  startRouteRound();
}

function submitRouteRound() {
  if (!routeGameActive) {
    setStatus('No route game running. Click "10-Address Route Game" first.');
    return;
  }
  if (!currentRouteAnswer || !guessMarker) {
    setStatus("Place your route/guess on the map before submitting.");
    return;
  }

  // Stop accepting further clicks for this round
  if (clickListener) {
    google.maps.event.removeListener(clickListener);
    clickListener = null;
  }

  const from = guessMarker.getPosition();
  const to = new google.maps.LatLng(
    currentRouteAnswer.lat,
    currentRouteAnswer.lng
  );

  const distMeters =
    google.maps.geometry.spherical.computeDistanceBetween(from, to);
  const distFeet = metersToFeet(distMeters);
  const points = scoreFromFeet(distFeet);

  routeTotalScore += points;
  routeHistory.push({
    round: routeCurrentRound,
    address: currentRouteAnswer.label,
    distanceFeet: distFeet,
    points,
  });

  actualMarker.setOpacity(1);

  const bounds = new google.maps.LatLngBounds();
  bounds.extend(to);
  bounds.extend(from);
  map.fitBounds(bounds);

  new google.maps.InfoWindow({
    content: `<b>${currentRouteAnswer.label}</b><br>${distFeet.toFixed(
      0
    )} ft<br>${points} pts`,
    position: to,
  }).open(map, actualMarker);

  setStatus(
    `Route round ${routeCurrentRound}: ${distFeet.toFixed(
      0
    )} ft → ${points} pts.`
  );
  updateGameUI();

  if (routeCurrentRound >= routeRoundsTotal) {
    routeGameActive = false;
    updateGameUI();
    setTimeout(showRouteFinalResults, 300);
  } else {
    setTimeout(() => {
      if (routeGameActive) startRouteRound();
    }, 1500);
  }
}

// -------------------------------
// GeoJSON → stations & zones
// -------------------------------
function parseStationIdFromProperties(props) {
  if (!props) return null;
  for (const v of Object.values(props)) {
    const m = String(v).match(/(\d+)/);
    if (m) return m[1];
  }
  return null;
}

function initZonesAndStationsFromGeoJSON() {
  if (!map) return;

  stationMarkers.forEach((m) => m.setMap(null));
  stationMarkers = [];
  stationZonePolygons.forEach(({ polygon }) => polygon.setMap(null));
  stationZonePolygons = [];

  (RESPONSE_ZONES_GEOJSON.features || []).forEach((feature) => {
    if (!feature.geometry) return;
    const geom = feature.geometry;
    const props = feature.properties || {};
    const stationId = parseStationIdFromProperties(props);
    if (!stationId) return;

    const color = STATION_COLORS[stationId] || "#999999";

    if (geom.type === "Point") {
      const [lng, lat] = geom.coordinates;
      const position = { lat, lng };
      const name = `Station ${stationId}`;

      STATIONS_BY_ID[stationId] = {
        id: stationId,
        name,
        lat,
        lng,
      };

      const marker = new google.maps.Marker({
        position,
        map,
        title: name,
        label: {
          text: stationId,
          color: "white",
          fontWeight: "bold",
        },
      });

      stationMarkers.push(marker);
    }

    if (geom.type === "Polygon") {
      const rings = geom.coordinates;
      if (!rings || !rings.length) return;

      const outerPath = rings[0].map(([lng, lat]) => ({ lat, lng }));

      const polygon = new google.maps.Polygon({
        paths: outerPath,
        strokeColor: color,
        strokeOpacity: 0.9,
        strokeWeight: 2,
        fillColor: color,
        fillOpacity: 0.08,
        map,
      });

      stationZonePolygons.push({ polygon, stationId });
    }
  });

  applyZoneVisibility();
  setStatus("Stations & response zones loaded. Choose a mode to start.");
}

// -------------------------------
// initMap (Google callback)
// -------------------------------
function initMap() {
  const center = { lat: 39.8425, lng: -88.9531 };

  map = new google.maps.Map(document.getElementById("map"), {
    center,
    zoom: 13,
    mapTypeId: "roadmap",
    styles: [],
  });

  geocoder = new google.maps.Geocoder();

  newDrillBtn.addEventListener("click", startSingleDrill);
  startGameBtn.addEventListener("click", startGame);
  startRouteGameBtn.addEventListener("click", startRouteGame);
  submitRouteBtn.addEventListener("click", submitRouteRound);
  streetNamesCheckbox.addEventListener("change", applyMapStyle);
  zonesCheckbox.addEventListener("change", applyZoneVisibility);

  applyMapStyle();
  updateGameUI();
  setStatus("Loading stations & zones…");

  initZonesAndStationsFromGeoJSON();
}

window.initMap = initMap;
